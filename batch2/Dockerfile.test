FROM {{ base_image.image }}

COPY hail/python/setup-hailtop.py /hailtop/setup.py
COPY hail/python/hailtop /hailtop/hailtop/
RUN python3 -m pip install --no-cache-dir /hailtop \
  && rm -rf /hailtop

COPY batch2/test/ /test/
RUN python3 -m pip install --no-cache-dir \
  pytest-instafail==0.4.1 \
  pytest-xdist==1.29.0 \
  pytest-asyncio==0.10.0

CMD ["python3", "-m", "pytest", "-s", "-v", "--instafail", "-n", "4", "/test/"]
